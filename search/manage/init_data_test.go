package manage

import (
	"errors"
	"fmt"
	"path/filepath"
	"testing"
	"travel_ai_search/search/conf"

	logger "github.com/sirupsen/logrus"
)

func dealTripData(tripDetail *TripDetail) (bool, error) {
	ExtractText(tripDetail.Detail[0])
	return false, errors.New("")
}

func TestParseData(t *testing.T) {
	logger.SetLevel(logger.InfoLevel)
	config := &conf.Config{
		CrawlerDataPath: "../../data/detail.jsonl",
	}
	absPath, err := filepath.Abs(config.CrawlerDataPath)
	if err != nil {
		t.Error("fetch data path error")
	}
	t.Log("file path:", absPath)

	passNum := ParseData(config, dealTripData)
	if passNum > 0 {
		t.Log("parse data num:", passNum)
	} else {
		t.Error("pass data err,num:", passNum)
	}

}

func TestExtractText(t *testing.T) {
	str := "<div id=\"floor-detail-trip\" class=\"floor-detail-trip\">\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"trip-par trip-detail-title\">\r\n                            <div class=\"title-bd\"></div>\r\n                            <h3 class=\"trip-title\">详细行程</h3>\r\n                        </div>\r\n                    </div>\r\n                     <!--第1天标题-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"trip-par day-no\">\r\n                            <img src=\"/ORG7188_templets/002/images/detail_49.jpg\">\r\n                            <h3 class=\"day-title\">第1天：  第一天：深圳—丽江—大理吉普车旅拍—沙溪古镇 (飞机)</h3>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!--含餐住宿-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"food-info\">\r\n                            <div class=\"breakfast\">\r\n                                <img src=\"/ORG7188_templets/002/images/detail_food.png\">\r\n                                早餐：敬请自理\r\n                            </div>\r\n                            <div class=\"lunch\">\r\n                                中餐：包含\r\n                            </div>\r\n                            <div class=\"dinner\">\r\n                                晚餐：包含\r\n                            </div>\r\n                            <div class=\"hotel\">\r\n                                <img src=\"/ORG7188_templets/002/images/detail_build.png\">\r\n                                酒店：\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!--行程内容-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"trip-par\">\r\n                            <div class=\"trip-article\">\r\n                                <!--每日行程里面的黑色字体加上类名： trip-day-title -->\r\n                              <p>\t　　指定时间乘车前往机场，乘飞机抵达美丽的【<a href=\"/lijiang/\">丽江</a>】，(参考航班：【<a href=\"/\">深圳</a>-丽江HO1945/06:35--09:30】)</p><p>\t　　抵达后，导游接机，后乘车前往<a href=\"/dali/\">大理</a>(车程约2.5小时)，后前往【网红洱海廊道+JEEP车+旅拍+打卡杨丽萍大剧院】，乘坐吉普车至【洱海生态廊道】，沿途欣赏苍山洱海边的田园风光，游览【陶然田舍】这里是网红旅拍打卡圣地，这里有天空之境，花海美拍，以家庭为单位，【每个家庭赠送4张电子照片】，沿途欣赏苍山洱海美景，游览【杨丽萍大剧院文化广场】在苍山脚下，洱海岸边，沉醉于大理新地标的超高颜值，吉普车合影拍照，狂野与艺术的完美结合。</p><p>\t　　温馨提示：</p><p>\t　　1、请您保持报名时预留电话的畅通，以便于接送人员能在第一时间内为您提供服务，出门在外请注意安全;2、<a href=\"/yunnan/\">云南</a>地属高原地区，气候易变、早晚温差较大、紫外线强度较大，请您做好替换衣物和防护准备;</p><div class=\"routeli\"> <img alt=\"丽江—大理吉普车旅拍—沙溪古镇\" src=\"https://www.citsqj.com/images/nopic.jpg\"></div>\r\n                            </div>\r\n\r\n                        </div>\r\n                    </div>\r\n                    <!--插图区-->\r\n                    \r\n                    <!--分割线-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"dot-line\"></div>\r\n                    </div>\r\n<!--第2天标题-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"trip-par day-no\">\r\n                            <img src=\"/ORG7188_templets/002/images/detail_49.jpg\">\r\n                            <h3 class=\"day-title\">第2天：  第二天：大理古城-S湾网红栈道-喜洲古镇-丽江 (汽车)</h3>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!--含餐住宿-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"food-info\">\r\n                            <div class=\"breakfast\">\r\n                                <img src=\"/ORG7188_templets/002/images/detail_food.png\">\r\n                                早餐：包含\r\n                            </div>\r\n                            <div class=\"lunch\">\r\n                                中餐：包含\r\n                            </div>\r\n                            <div class=\"dinner\">\r\n                                晚餐：敬请自理\r\n                            </div>\r\n                            <div class=\"hotel\">\r\n                                <img src=\"/ORG7188_templets/002/images/detail_build.png\">\r\n                                酒店：\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!--行程内容-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"trip-par\">\r\n                            <div class=\"trip-article\">\r\n                                <!--每日行程里面的黑色字体加上类名： trip-day-title -->\r\n                              <p>\t　　早餐后，乘车去游览历史文化名城【<a href=\"/dali/\">大理</a>古城】，城内依然保存着大量的明清以及民国时期的建筑，寺庙、书院、教堂等古建筑点缀其间，古老斑驳的城墙与街道，盛名远洋的文献楼，青瓦屋檐的民宅无一不是南诏古国历史的缩影。自由活动中可前往打卡南城门、五华楼、红龙井，更有诸多美食老酸奶、烤乳扇、包浆豆腐、凉鸡米线、木瓜水、各类梅子等。</p><p>\t　　后游览【S湾网红栈道】(环游洱海骑行)大理“最值得”去的网红地，磻溪村最美转角——S湾栈道，</p><p>\t　　一人一车，一步一景，海边栈道没有遮挡物，视野宽阔，让人有一种“亲近自然，融入其中”的感觉。</p><p>\t　　午餐后，乘车前往【喜洲古镇】(赠送小马车)喜洲镇位于<a href=\"/yunnan/\">云南</a>省西北大理白族自治州大理市的北部，全镇共有明代、清代、民国以及当代各个时期各具特色的上百院白族民居建筑。远远望去，像一座古朴典雅的城池，更像是一座巨大的民居建筑博物馆。安排乘坐【小马车】游喜洲古镇，沿着乡村的小路前进，就让时光慢慢的走吧。</p><p>\t　　游玩介绍后，返程回<a href=\"/lijiang/\">丽江</a>。入住备选酒店。</p><div class=\"routeli\"> <img alt=\"大理古城-S湾网红栈道-喜洲古镇-丽江\" src=\"https://www.citsqj.com/images/nopic.jpg\"></div>\r\n                            </div>\r\n\r\n                        </div>\r\n                    </div>\r\n                    <!--插图区-->\r\n                    \r\n                    <!--分割线-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"dot-line\"></div>\r\n                    </div>\r\n<!--第3天标题-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"trip-par day-no\">\r\n                            <img src=\"/ORG7188_templets/002/images/detail_49.jpg\">\r\n                            <h3 class=\"day-title\">第3天：  第三天：丽江玉龙雪山-大索道-印象丽江-蓝月谷-丽江古城 (汽车)</h3>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!--含餐住宿-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"food-info\">\r\n                            <div class=\"breakfast\">\r\n                                <img src=\"/ORG7188_templets/002/images/detail_food.png\">\r\n                                早餐：包含\r\n                            </div>\r\n                            <div class=\"lunch\">\r\n                                中餐：敬请自理\r\n                            </div>\r\n                            <div class=\"dinner\">\r\n                                晚餐：包含\r\n                            </div>\r\n                            <div class=\"hotel\">\r\n                                <img src=\"/ORG7188_templets/002/images/detail_build.png\">\r\n                                酒店：\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!--行程内容-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"trip-par\">\r\n                            <div class=\"trip-article\">\r\n                                <!--每日行程里面的黑色字体加上类名： trip-day-title -->\r\n                              <p>\t　　早餐后，早餐后，乘车前往游览游览【玉龙雪山风景区】;乘【冰川大索道】</p><p>\t　　(旺季黄金周大索道承载能力有限，玉龙雪山风景区提前实行限票管理制度，如遇无法正常安排的情况、下，</p><p>\t　　更改为云杉坪索道，并现退差价80元/人。)前往誉为“现代冰川博物馆”和“植物王国”之称的玉龙雪山，冰雕玉砌的玉龙雪山拔地而起，直插云霄，气势磅礴，洋溢着雄奇壮丽之美。观雪山雄伟奇丽的美景。</p><p>\t　　欣赏以雪山主峰为幕景的实景大型民族歌舞《印象<a href=\"/lijiang/\">丽江</a>》雪山篇，该剧由著名导演张艺谋倾心力作，在天地之间体验</p><p>\t　　纯原生态演出(此为套票项目团友不去费用不退，表演时间约65分钟左右)。</p><p>\t　　温馨提示：观看《印象丽江》的时间根据订票时间可能会进行适当调整，如有不便之处请见谅。</p><p>\t　　之后游览被称为“小九寨”的【蓝月谷】(游览时间约30分钟，如需乘坐景区电瓶车可自行前往售票处购买电瓶车票</p><p>\t　　60元/人)。 它以玉龙雪峰为衬，四围林莽苍翠，四个湖面如纯净的蓝宝石，美不胜收。景区视野开阔，整个湖面尽</p><p>\t　　收眼底，蔚蓝的湖水、湛蓝的天空、绿树环绕的湖岸、景色壮观的玉龙雪山，构成一幅美妙画卷，美丽的花丛尽头是</p><p>\t　　原始的森林或是神秘的生灵。</p><p>\t　　下山后，返程回丽江，游览【束河古镇】乘车前往张艺谋《千里走单骑》拍摄基地、世界文化遗产---【束河古镇】</p><p>\t　　(游览时间约1小时)，了解纳西族历史文化民俗风情。游览结束后，安排晚餐，晚餐后回备选酒店入住休息。</p><div class=\"routeli\"> <img alt=\"丽江玉龙雪山-大索道-印象丽江-蓝月谷-丽江古城\" src=\"https://www.citsqj.com/images/nopic.jpg\"></div>\r\n                            </div>\r\n\r\n                        </div>\r\n                    </div>\r\n                    <!--插图区-->\r\n                    \r\n                    <!--分割线-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"dot-line\"></div>\r\n                    </div>\r\n<!--第4天标题-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"trip-par day-no\">\r\n                            <img src=\"/ORG7188_templets/002/images/detail_49.jpg\">\r\n                            <h3 class=\"day-title\">第4天：  第四天：丽江-虎跳峡-普达措国家森林公园-独克宗古镇-香格里拉 (汽车)</h3>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!--含餐住宿-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"food-info\">\r\n                            <div class=\"breakfast\">\r\n                                <img src=\"/ORG7188_templets/002/images/detail_food.png\">\r\n                                早餐：包含\r\n                            </div>\r\n                            <div class=\"lunch\">\r\n                                中餐：包含\r\n                            </div>\r\n                            <div class=\"dinner\">\r\n                                晚餐：包含\r\n                            </div>\r\n                            <div class=\"hotel\">\r\n                                <img src=\"/ORG7188_templets/002/images/detail_build.png\">\r\n                                酒店：\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!--行程内容-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"trip-par\">\r\n                            <div class=\"trip-article\">\r\n                                <!--每日行程里面的黑色字体加上类名： trip-day-title -->\r\n                              <p>\t　　早餐后，乘车前往往<a href=\"/xianggelila/\">香格里拉</a>，途经【长江第一湾】(车程约45分钟，停车拍照约15分钟)，之后前往有世界峡谷之称-【虎跳峡】(车程约60分钟，游览时间约60分钟，虎跳峡是世界上著名的大峡谷, 也是中国深的峡谷之一，以“险”而闻名天下)，</p><p>\t　　午餐后，乘车前往【普达措国家森林公园】(车程约90分钟，游览时间约180分钟)普达措国家公园是一个无任何污染的童话世界，湖清清，天湛蓝，林涛载水声，鸟语伴花香，一年四季景色各不相同。，漫游花海草甸，走进森林成毡的净土，赏雪域高原上的美丽湖泊属都湖，观赏茂密原始森林。</p><p>\t　　后游览【独克宗古城】(车程约30分钟，游览60分钟)合力转动世界上最大的转经筒，为家人祈福!</p><p>\t　　晚上观看藏族有特色的歌舞表演-【土司宴】(车程约40分钟，游览时间约90分钟)品藏家牦牛小火锅青稞面，酥油茶等，观看特色民族风情晚会,边吃边欣赏!结束后入住酒店休息。</p><div class=\"routeli\"> <img alt=\"丽江-虎跳峡-普达措国家森林公园-独克宗古镇-香格里拉\" src=\"https://www.citsqj.com/images/nopic.jpg\"></div>\r\n                            </div>\r\n\r\n                        </div>\r\n                    </div>\r\n                    <!--插图区-->\r\n                    \r\n                    <!--分割线-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"dot-line\"></div>\r\n                    </div>\r\n<!--第5天标题-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"trip-par day-no\">\r\n                            <img src=\"/ORG7188_templets/002/images/detail_49.jpg\">\r\n                            <h3 class=\"day-title\">第5天：  第五天：香格里拉坛城-纳帕海景区-丽江-送机-深圳 (飞机)</h3>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!--含餐住宿-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"food-info\">\r\n                            <div class=\"breakfast\">\r\n                                <img src=\"/ORG7188_templets/002/images/detail_food.png\">\r\n                                早餐：包含\r\n                            </div>\r\n                            <div class=\"lunch\">\r\n                                中餐：包含\r\n                            </div>\r\n                            <div class=\"dinner\">\r\n                                晚餐：包含\r\n                            </div>\r\n                            <div class=\"hotel\">\r\n                                <img src=\"/ORG7188_templets/002/images/detail_build.png\">\r\n                                酒店：\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!--行程内容-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"trip-par\">\r\n                            <div class=\"trip-article\">\r\n                                <!--每日行程里面的黑色字体加上类名： trip-day-title -->\r\n                              <p>\t　　早餐后，乘车前往游览【香巴拉时轮坛城】(车程约40分钟，游览时间约180分钟)，坛城于2005年开始建设，经过了十年多的努力，建成了一座非常宏伟高大的建筑，集现代建筑与藏式建筑风格为一体。是目前藏区介绍藏文化及藏传佛教文化较为全面的场所。整个文化博览中心占地面积为22亩，建筑面积为25131平米。顶层为白塔式镀金金顶。整个建筑在藏区是独一无二的，尤其是外观设计、装修和彩绘方面更为突出。主建筑中心大楼共11层，高约60米，耗资近6亿元人民币的香巴拉时轮坛城文化博览中心。</p><p>\t　　后游览【纳帕海景区】纳帕海位于<a href=\"/xianggelila/\">香格里拉</a>县城西北部，是高原季节性湖泊。纳帕海四季景致各有特色，可以到湿地前拍几张照片，或者在蒙蒙细雨中感受浓浓的乡土气息。纳帕草原尽收眼底 ，在清幽、宁静的自然风光中凭吊古迹，别有一番风情。游玩结束后，返程回<a href=\"/lijiang/\">丽江</a>(车程约4小时)，抵达后安排晚餐，后根据航班时间安排送机，结束愉快的<a href=\"/yunnan/\">云南</a>之旅!(参考航班：【丽江-<a href=\"/\">深圳</a> HO1946/22:15--00:30+1】(直飞))</p><div class=\"routeli\"> <img alt=\"香格里拉坛城-纳帕海景区-丽江-送机-深圳\" src=\"https://www.citsqj.com/images/nopic.jpg\"></div>\r\n                            </div>\r\n\r\n                        </div>\r\n                    </div>\r\n                    <!--插图区-->\r\n                    \r\n                    <!--分割线-->\r\n                    <div class=\"trip-flex\">\r\n                        <div class=\"dot-line\"></div>\r\n                    </div>\r\n\r\n                \r\n                </div>"

	values, err := ExtractText(str)
	if err != nil {
		t.Error("extract text err:", err)
	}
	fmt.Println(values)
	fmt.Println("end")
}
